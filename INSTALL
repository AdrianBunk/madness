
CONFIGURING
===========

We are using standard GNU configure scripts but since we rely upon
MPI, BLAS, LAPACK and other non-standard libraries most machines
require options passed to configure and build.  More information on
the MADNESS software environment is available on the wiki at

   http://code.google.com/p/m-a-d-n-e-s-s/wiki/SoftwareEnvironment


Hardware requirements:

  o A recent x86 cpu (32 or 64 bit) with SSE3 instructions (if you do
    not have sse3, see below), or

  o IBM BG/P


Software requirements:

  o  MPI-2 with mpicc and mpicxx (tested with mpich2 and openmpi)

  o  BLAS

  o  LAPACK

  o  C and C++ compilers: gcc, g++ (most versions 4.1.*, 4.3.*, 4.4.*
     should work but we recommend 4.4.2)

  o  If you are building from the respository you will also need
     autoconf and automake.


Optional:

  o  Google performance tools (the malloc library is fast and it is the only
     free multithreaded performance analysis tool)
     

  o  GTest from google unit test


If you checked the source out of subversion:

  o  You will need to run autoreconf (no options necessary) in the trunk directory
     to build the configure scripts


Configure options:

  Run the configure script with option --help to obtain a full list of options.
  The most commonly used are:

  o  --with-libunwind=dir ... directory containing libunwind.a for google profiler

  o  --with-google-perf=dir ... installation directory for google performance tools 
     (that specified with --prefix=dir when configuring the tools)

  o  --with-google-test=dir ... installation directory for google unit test library
     (that specified with --prefix=dir when configuring the library)

  o  --enable-spinlocks ... forces use of spin locks instead of futex (enabled by
     default on Cray XT and IBM BG/P)

  o  --enable-never-spin ... completely disables use of spinlocks (necessary for using VMs)


CONFIGURE COMMAND EXAMPLES
==========================

  o  Linux workstation or cluster using GNU compilers
     (some systems might require additional libraries to resolve Fortran
      symbols used by LAPACK/BLAS)

     - 32 or 64 bit using system default BLAS and LAPACK
    
       ./configure LIBS="-llapack -lblas -lgfortran"

     - 64-bit with Intel MKL installed

       ./configure LIBS="-L/opt/intel/mkl/10.0.1.014/lib/em64t -lmkl -lguide -lpthread -lm"

     - 32-bit with Intel MKL installed

       ./configure LIBS="-L/opt/intel/mkl/10.0.1.014/lib/32 -lmkl -lguide -lpthread -lm"

     - 32-bit with Intel MKL installed and also including MPFR and GSL 

       ./configure LIBS="-I/usr/include/gsl -L/opt/intel/mkl/10.0.1.014/lib/32 -lgsl -lgslcblas -lmkl -lguide -lpthread -lm -lmpfr -lgmp"

     - 64-bit with MKL, google's fast malloc and profiler library

       ./configure LIBS="-L/opt/intel/mkl/10.0.1.014/lib/em64t -lmkl -lguide -lpthread -lm" -with-google-perf=/usr/local/gperftools

      - 64-bit with AMD ACML

      ./configure LIBS="-L/usr/local/acml4.2.0/gfortran64_int64/lib -lacml  -lacml_mv -lgfortran -lstdc++"

      - 64-bit with AMD ACML, google's super-fast malloc and google's profiler library

      ./configure LIBS="-L/usr/local/acml4.2.0/gfortran64_int64/lib -L/usr/local/gperftools-20090306/lib -L/usr/local/libunwind-20090306 -lacml  -lacml_mv -lprofiler -ltcmalloc -lunwind-x86_64 -lgfortran -lstdc++"


  o  Cray-XT (e.g., jaguar@ornl and jaguarpf@ornl, kraken at NICS and franklin at NERSC) 
     [Module commands assume you start from the default which is PGI and scilib]

     - with GNU compilers and ACML - RECOMMENDED

       This is recommended since the GNU compiler is about 10x faster at
       compiling and has comparable execution speed to PGI.  ACML is
       also faster than the Goto BLAS in scilib for the small matrices
       primarily used by MADNESS and does not have a huge piece of
       static memory reserved.
     
       module swap PrgEnv-pgi PrgEnv-gnu
       module swap gcc/4.3.2 gcc/4.4.2
       module load acml/4.3.0

       ./configure

     - with GNU compilers and scilib

       module swap PrgEnv-pgi PrgEnv-gnu
       module swap gcc/4.3.2 gcc/4.4.2
       ./configure


  o  IBM BlueGene-P @ ANL

     For other BGP boxes you will need to find these compilers and libraries.  
     They seem to be site dependent.

#!/bin/bash
export LIBS=""
export LIBS="${LIBS} -L/home/robert/install/lib -llapack_bgp"
export LIBS="${LIBS} -L/soft/apps/ESSL-4.4.1-0/lib -lesslbg"
export LIBS="${LIBS} -L/soft/apps/ibmcmp-aug2009/xlf/bg/11.1/bglib -lxlf90_r -lxlfmath"
export LIBS="${LIBS} -L/soft/apps/ibmcmp-aug2009/xlsmp/bg/1.7/bglib -lxlsmp -lxl"
export LIBS="${LIBS} -L/bgsys/drivers/ppcfloor/gnu-linux/powerpc-bgp-linux/lib -lrt"
export LIBS="${LIBS} -lpthread"

export CPPFLAGS="-I/bgsys/drivers/ppcfloor/arch/include"

./configure \
  --build=powerpc-bgp-linux-gnu \
  --with-google-test=/home/robert/install \
  LIBS="${LIBS}" \
  CPPFLAGS="${CPPFLAGS}" 


  o  Macintosh Darwin 10.6, snow leopard --- tested with gcc 4.5, reference versions of BLAS and LAPACK, MPICH

     - with reference LAPACK and BLAS

       ./configure LIBS="-L/Users/harrison/install/lib -lLAPACK -lBLAS -lgfortran" CPPFLAGS="-I/Users/harrison/install/include"

     - using vecLib (comes standard on OS X)

       ./configure LIBS="/System/Library/Frameworks/vecLib.framework/vecLib" CPPFLAGS='-I/System/Library/Frameworks/vecLib.framework/Headers'

  o On Linux without sse3 -- If you have one of these older CPUs this is a two step process.  Build and install the
  BLAS, LAPACK, MPI librarires as per instruction above. Execute the configure script for your box.  Then

  make CXX="mpicxx -DDISABLE_SSE3"

  will build madness without the fast assembly codes in versions gcc 4.3.2.  If you have version 4.3.3, you will need
  to edit madness/src/lib/tensor/Makefile after running configure to add -DDISABLE_SSE3 at the end of  the CXXFLAGS definitions.
  Go back to the madness directory and then do make.  This last method always work.

    



