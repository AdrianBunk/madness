#!/bin/sh

function usage() {
   echo "Usage: INSTALL --help        print this text"
   echo " "
   echo "Usage: INSTALL target"
   echo " "
   echo " where target is one of the following:"
   echo " "
   echo "    mpich-gcc4-x86    ---> 32-bit x86 with mpich 1 or 2 and gcc-4/gfortran"
   echo "    mpich-gcc4-x86-64 ---> 64-bit x86 with mpich 1 or 2 and gcc-4/gfortran"
   echo "    mpich-gcc3-x86    ---> 32-bit x86 with mpich 1 or 2 and gcc-3/g77"
   echo "    mpich-gcc3-x86-64 ---> 64-bit x86 with mpich 1 or 2 and gcc-3/g77"
   echo " "
   echo "    To override the default choice of BLAS/LAPACK libraries set the environment"
   echo "    variables MADBLAS and/or MADLAPACK."
   echo " "
   echo "    To override the default compiler optimization flags set MADCOPT."
   echo " "
   echo "    To override the default architecture choice set MADARCH."
   echo " "
   echo "    To set additional defines/includes set MADCDEF."
   echo " "
   echo "    To set additional libraries set MADLIBS."
   echo " "
   echo "    For full control, run the configure script."
   echo " "
}

if [ $# != 1 ] ; then
   usage
   exit 1
fi

if [ $1 == "--help" ] ; then
   usage
   exit 0
fi

target="$1"

# The initial stuff at the beginning takes care of most UNIX or LINUX platforms.
# Complete special cases are at the end wrapping the call to configure.

if [ "$MADBLAS" == "" ] ; then
  MADBLAS="-lblas"
fi;

if [ "$MADLAPACK" == "" ] ; then
  MADLAPACK="-llapack"
fi;

if [ "$MADARCH" == "" ] ; then
  if [[ "$target" == "mpich-gcc4-x86" || "$target" == "mpich-gcc4-x86-64" ]]; then
    MADARCH="-march=native"
  fi
fi

if [ "$MADCOPT" == "" ] ; then
  MADCOPT="-Wall -ansi -O3 -ffast-math -fomit-frame-pointer -funroll-loops -malign-double -mfpmath=sse -msse2"
fi

if [ "$target" == "mpich-gcc3-x86-64" ] ; then
   MADFINT="--with-fortran-integer=int"
   MADLIBS="$MADLIBS -lg2c"
fi

if [ "$target" == "mpich-gcc3-x86" ] ; then
   MADLIBS="$MADLIBS -lg2c"
fi


MADDEF="$MADDEF -DX8632 -DHAS_XTERM_DEBUG"  

MADCXX="mpicxx"
MADCC="mpicc"
MADCXXFLAGS="$MADDEF $MADCOPT $MADARCH"
MADCFLAGS="$MADCXXFLAGS"

echo ./configure --with-cxx=\"$MADCXX\" --with-cc=\"$MADCC\"    \\
echo "            "--with-cxx-optflags=\"$MADCXXFLAGS\"  \\
echo "            "--with-cc-optflags=\"$MADCFLAGS\" \\
echo "            "--with-blas=\"$MADBLAS\" --with-lapack=\"$MADLAPACK\" \\
echo "            "--with-libs=\"$MADLIBS\"

./configure --with-cxx="$MADCXX" --with-cc="$MADCC" \
            --with-cxx-optflags="$MADCXXFLAGS" --with-cc-optflags="$MADCFLAGS" \
            --with-blas="$MADBLAS" --with-lapack="$MADLAPACK" \
            --with-libs="$MADLIBS"


