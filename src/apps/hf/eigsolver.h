#include <mra/mra.h>
#include <world/world.h>
#include <vector>

namespace madness
{
//***************************************************************************
// TYPEDEFS
typedef SharedPtr< FunctionFunctorInterface<double,3> > functorT;
typedef Function<double,3> funcT;
typedef Vector<double,3> coordT;
//***************************************************************************

//***************************************************************************
class EigSolverOp
{
public:
  //*************************************************************************
  // Constructor
  EigSolverOp(double coeff) : _coeff(coeff) {}
  //*************************************************************************

  //*************************************************************************
  // Destructor
  virtual ~EigSolverOp() {}
  //*************************************************************************
  
  //*************************************************************************
  virtual funcT op(std::vector<funcT> phis, funcT psi) = 0;
  //*************************************************************************

  //*************************************************************************
  double coeff() {return _coeff;}
  //*************************************************************************
  
private:
  //*************************************************************************
  double _coeff;
  //*************************************************************************
};
//***************************************************************************

//***************************************************************************
class EigSolver
{
public:
  //*************************************************************************
  // Constructor
  EigSolver(World& world, std::vector<funcT> phis, std::vector<double> eigs,
      std::vector<EigSolverOp*> ops, double thresh);
  //*************************************************************************

  //*************************************************************************
  // Constructor for ground state only
  EigSolver(World& world, funcT phi, double eig, std::vector<EigSolverOp*> ops, 
      double thresh);
  //*************************************************************************

  //*************************************************************************
  // Destructor
  virtual ~EigSolver();
  //*************************************************************************

  //*************************************************************************
  void solve(int maxits);
  //*************************************************************************

private:
  //*************************************************************************
  // List of the functions
  std::vector<funcT> _phis;
  //*************************************************************************

  //*************************************************************************
  // List of the eigenvalues
  std::vector<double> _eigs;
  //*************************************************************************

  //*************************************************************************
  // List of the ops
  std::vector<EigSolverOp*> _ops;
  //*************************************************************************

  //*************************************************************************
  World& _world;
  //*************************************************************************

  //*************************************************************************
  double _thresh;
  //*************************************************************************

  //*************************************************************************
  functorT ones;
  functorT zeros;
  //*************************************************************************

};
//***************************************************************************

}
