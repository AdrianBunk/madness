# PWD = current dir - remove backslashes and quote whitespace
PWD := $(shell pwd)
PWD := "$(subst \,/,$(PWD))"

# this is usually overridden
ifndef TARGET_TO_MAKE
  TARGET_TO_MAKE = $(notdir $(PWD))
endif

ifndef SRCDIR
  SRCDIR = .
endif

ifndef BIN_OR_LIB
  BIN_OR_LIB = LIB
endif

# this vpath works with listlibs to find the libraries
vpath %.a $(TOPDIR)/lib
vpath %.so $(TOPDIR)/lib
vpath %.la $(TOPDIR)/lib

# SRCTOPDIR is the top of the source directory
SRCTOPDIR := $(TOPDIR)

-include $(TOPDIR)/lib/MakeVars

ifeq ($(BIN_OR_LIB),LIB)
  LIBOBJ = $(CXXSRC:%.cc=%.$(OBJSUF))
  LIBOBJ += $(CSRC:%.c=%.$(OBJSUF))
  LIBOBJ += $(FTNSRC:%.f=%.$(OBJSUF))
endif

ifdef TEST1SRC
  TEST1OBJ = $(TEST1SRC:%.cc=%.$(OBJSUF))
endif

ifdef TEST2SRC
  TEST2OBJ = $(TEST2SRC:%.cc=%.$(OBJSUF))
endif

ifdef TEST3SRC
  TEST3OBJ = $(TEST3SRC:%.cc=%.$(OBJSUF))
endif

ifdef TEST4SRC
  TEST4OBJ = $(TEST4SRC:%.cc=%.$(OBJSUF))
endif

ifdef TEST5SRC
  TEST5OBJ = $(TEST5SRC:%.cc=%.$(OBJSUF))
endif

ifdef TEST6SRC
  TEST6OBJ = $(TEST6SRC:%.cc=%.$(OBJSUF))
endif

ifdef TEST1SRC
  TESTOBJ = $(TEST1OBJ) $(TEST2OBJ) $(TEST3OBJ) $(TEST4OBJ) $(TEST5OBJ) $(TEST6OBJ)
endif

THISLIBDEPEND = $(shell $(LISTLIBS) $(INCLUDE) $(SRCDIR)/LIBS.h)

#default::
#	echo SUBDIRS is $(SUBDIRS)
	
ifndef SUBDIRS
-include $(TOPDIR)/lib/MakeRules
endif

ifneq ($(DODEPEND),no)
ifdef LIBOBJ
  include $(LIBOBJ:.$(OBJSUF)=.d)
endif
ifdef TESTOBJ
  include $(TESTOBJ:%.$(OBJSUF)=%.d)
endif
endif



